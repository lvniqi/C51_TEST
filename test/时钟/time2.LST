C51 COMPILER V9.00   TIME2                                                                 03/28/2013 14:21:36 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE TIME2
OBJECT MODULE PLACED IN time2.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE time2.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include"normal.h"
   2          #include"led_4.h"
   3          #include"key.h"
   4          extern uchar keys[8]; 
   5          uchar flag=0,a,temp=0;
   6          uint timer=0;
   7          uint Temp1=0;
   8          void com_init(void);
   9          void set_timer(void);
  10          void Set_time(uint *a);
  11          int main(void)
  12          {
  13   1              com_init();
  14   1              set_timer();
  15   1              while(1)
  16   1              {
  17   2                      if(flag==1)
  18   2                      {
  19   3                              ES=0;
  20   3                              flag=0;
  21   3                              SBUF=a;
  22   3                              while(!TI);
  23   3                              TI=0;
  24   3                              ES=1;
  25   3                       }
  26   2                       while(temp>3)
  27   2                      {
  28   3                              ES=0;
  29   3                              ET2=1;          //开定时器2中断
  30   3                              TR2=1;          //开启定时器，并设置为自动重装载模式
  31   3                              if(timer==20*60)
  32   3                              {
  33   4                                      Temp1+=1;
  34   4                                      timer=0;
  35   4                                      Set_time(&Temp1);
  36   4                              }
  37   3                              Led_set(Temp1);
  38   3                              Led_display(LED_Buffer);
  39   3                      }
  40   2              }
  41   1      }
  42          void server(void) interrupt 4
  43          {
  44   1              static i=0;
  45   1              if(1==RI)
  46   1              {
  47   2                      RI=0;
  48   2                      flag=1;
  49   2                      temp++;
  50   2                      a=SBUF;
  51   2                      if(i)
  52   2                      {
  53   3                              Temp1*=10;
  54   3                              Temp1+=a-'0';
  55   3                              }
C51 COMPILER V9.00   TIME2                                                                 03/28/2013 14:21:36 PAGE 2   

  56   2                      i++;
  57   2              }
  58   1      }
  59          void com_init(void)
  60          {
  61   1          TMOD=0X20;//设置定时器工作方式
  62   1              PCON = 0x00;//不用倍速
  63   1          REN=1;//打开串口
  64   1              SM0=0;//设定串口模式
  65   1              SM1=1;//设定串口模式
  66   1              TH1=0XFD;//设置寄存器初值
  67   1              TL1=0XFD;
  68   1              TR1=1;//启动定时器1
  69   1              ES=1;//打开串口中断
  70   1              EA=1;//总中断
  71   1      }
  72          void set_timer(void)
  73          {
  74   1              RCAP2H=19456/256;
  75   1              RCAP2L=19456%256;
  76   1      }
  77          void Timer_ET2_50ms() interrupt 5//延时50ms
  78          {
  79   1              TF2=0;
  80   1              timer++;
  81   1      }
  82          void Set_time(uint *a)//时间标准化
  83          {
  84   1              static uchar x=60;
  85   1              if(x==60)
  86   1              {
  87   2                      uchar temp1=*a%100;
  88   2                      uchar temp2=*a/100;
  89   2                      uchar temp3=temp1/60;
  90   2                      temp1%=60;
  91   2                      temp2+=temp3;
  92   2                      if(temp2==24)
  93   2                              temp2=0;
  94   2                      *a=temp2*100+temp1;
  95   2                      if(temp1==0)
  96   2                              x=1;
  97   2              }
  98   1              else
  99   1                      x++;
 100   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    767    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     23      16
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
