C51 COMPILER V9.00   TIME2                                                                 03/28/2013 14:18:19 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE TIME2
OBJECT MODULE PLACED IN time2.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE time2.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include"normal.h"
   2          #include"led_4.h"
   3          #include"key.h"
   4          extern uchar keys[8]; 
   5          uchar flag=0,a,temp=0,count2=0;
   6          uint timer=0;
   7          uint Temp1=0;
   8          void com_init(void);
   9          void set_timer(void);
  10          void Set_time(uint *a);
  11          void Set(uchar key1);
  12          int main(void)
  13          {
  14   1              int count2;
  15   1              uchar key_temp;
  16   1              com_init();
  17   1              set_timer();
  18   1              while(1)
  19   1              {
  20   2                       if(temp>3)
  21   2                      {
  22   3                              ES=0;
  23   3                      }
  24   2                      if(timer==20*60)
  25   2                              {
  26   3                                      Temp1+=1;
  27   3                                      timer=0;
  28   3                                      Set_time(&Temp1);
  29   3                              }
  30   2                      key_temp=Keys(keys);
  31   2                      if(key_temp)
  32   2                      {                       
  33   3                              count2++;
  34   3                              if(count2==35)
  35   3                              {
  36   4                                      count2=0;
  37   4                                      Set(key_temp);
  38   4                                      Set_time(&Temp1);
  39   4                              }
  40   3                      }
  41   2                      Led_set(Temp1);
  42   2                      Led_display(LED_Buffer);
  43   2              }
  44   1      }
  45          void server(void) interrupt 4
  46          {
  47   1              static i=0;
  48   1              if(1==RI)
  49   1              {
  50   2                      RI=0;
  51   2                      temp++;
  52   2                      if(i)
  53   2                      {
  54   3                              Temp1*=10;
  55   3                              Temp1+=SBUF-'0';
C51 COMPILER V9.00   TIME2                                                                 03/28/2013 14:18:19 PAGE 2   

  56   3                      }
  57   2                      i++;
  58   2              }
  59   1      }
  60          void com_init(void)
  61          {
  62   1          TMOD=0X20;//设置定时器工作方式
  63   1              PCON = 0x00;//不用倍速
  64   1          REN=1;//打开串口
  65   1              SM0=0;//设定串口模式
  66   1              SM1=1;//设定串口模式
  67   1              TH1=0XFD;//设置寄存器初值
  68   1              TL1=0XFD;
  69   1              TR1=1;//启动定时器1
  70   1              ES=1;//打开串口中断
  71   1              EA=1;//总中断
  72   1      }
  73          void set_timer(void)
  74          {
  75   1              RCAP2H=19456/256;
  76   1              RCAP2L=19456%256;
  77   1              ET2=1;          //开定时器2中断
  78   1              TR2=1;          //开启定时器，并设置为自动重装载模式
  79   1      }
  80          void Timer_ET2_50ms() interrupt 5//延时50ms
  81          {
  82   1              TF2=0;
  83   1              timer++;
  84   1      }
  85          void Set_time(uint *a)//时间标准化
  86          {
  87   1              uchar temp1=*a%100;
  88   1              uchar temp2=*a/100;
  89   1              uchar temp3=temp1/60;
  90   1              temp1%=60;
  91   1              temp2+=temp3;
  92   1              if(temp2>=24)
  93   1                      temp2-=24;
  94   1              *a=temp2*100+temp1;
  95   1      }
  96          void Set(uchar key1)
  97          {
  98   1              switch(key1)
  99   1              {
 100   2              case 16:        Temp1+=1000;break;
 101   2              case 15:        Temp1+=100;break;
 102   2              case 14:        Temp1+=10;break;
 103   2              case 13:        Temp1++;break;
 104   2              case 12:        Temp1-=1000;break;
 105   2              case 11:        Temp1-=100;break;
 106   2              case 10:        Temp1-=10;break;
 107   2              case 9:         Temp1--;break;
 108   2              };
 109   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    867    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     23      16
C51 COMPILER V9.00   TIME2                                                                 03/28/2013 14:18:19 PAGE 3   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
