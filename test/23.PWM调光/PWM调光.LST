C51 COMPILER V9.00   PWM调_                                                               04/03/2013 02:13:43 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE PWM调_
OBJECT MODULE PLACED IN PWM调光.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE PWM调光.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /****************************************************
   2           * 声明:        此制作为CIKY单片机学习过程，欢迎爱好者
   3           *              一起学习和探讨，共同进步。
   4           * Title:       模拟PWM输出
   5           * Description: 51单片机模拟PWM输出控制灯的100个亮度级
   6           * @author      CIKY
   7           * Date:        Jan. 06, 2010
   8          ****************************************************/
   9          
  10          #include "normal.h"
  11          #include "led_4.h"
  12          #define uInt unsigned int
  13          #define uchar unsigned char
  14          uchar PWM_T = 0;   //占空比控制变量
  15          uchar timer=0;
  16          uchar n=0;
  17          void set_timer(void)  ;
  18          //////////////////主程序入口//////////////////////
  19          void main(void)       
  20          { 
  21   1       bit flag = 1; //控制灯渐亮渐熄方式
  22   1      
  23   1       TMOD=0x02;   //定时器0，工作模式2，8位定时模式 
  24   1       TH0=210;     //写入预置初值（取值1-255，数越大PWM频率越高）
  25   1       TL0=210;     //写入预置值 （取值1-255，数越大PWM频率越高）
  26   1       TR0=1;       //启动定时器 
  27   1       ET0=1;       //允许定时器0中断
  28   1      set_timer()   ;
  29   1       EA=1;        //允许总中断
  30   1      
  31   1       P1=0xff;  //初始化P1
  32   1      
  33   1       while(1)     
  34   1       {    
  35   2                        //延时，将响应定时器中断，灯会自动加/减一个档次的亮度
  36   2                                   //取值0-65535，数字越大变化越慢
  37   2              if(timer==3)
  38   2               { 
  39   3                      if(flag==1)   //灯渐亮
  40   3                              PWM_T++;
  41   3                      else    //灯渐熄
  42   3                              PWM_T--;
  43   3          
  44   3                       if(PWM_T>=100) //设置灯亮度级别为10
  45   3                               flag=0;
  46   3      
  47   3                       if(PWM_T==0)   //限定最低亮度级别为0
  48   3                              flag = 1;
  49   3                      timer=0;
  50   3                      n++;
  51   3                      Led_set(n);
  52   3              }
  53   2              Led_display(LED_Buffer)         ;
  54   2       }      
  55   1      
C51 COMPILER V9.00   PWM调_                                                               04/03/2013 02:13:43 PAGE 2   

  56   1      }
  57          
  58          ///////////////////定时器0中断模拟PWM////////////////////
  59          timer0() interrupt 1 using 2   
  60          { 
  61   1       static  uint   t ;   //PWM计数
  62   1      
  63   1       t++;    //每次定时器溢出加1
  64   1        
  65   1       if(t==600)   //PWM周期
  66   1      
  67   1       { 
  68   2        t=0;  //使t=0，开始新的PWM周期 
  69   2        P1=0x00;  //使LED灯亮   
  70   2         
  71   2       }
  72   1        
  73   1       if(PWM_T==t)  //按照当前占空比切换输出为高电平 
  74   1        P1=0xff;        //使LED灯灭   
  75   1      }
  76          void set_timer(void)
  77          {
  78   1              RCAP2H=19456/256;
  79   1              RCAP2L=19456%256;
  80   1              ET2=1;          //开定时器2中断
  81   1              TR2=1;          //开启定时器，并设置为自动重装载模式
  82   1              EA=1;
  83   1      }
  84          void Timer_ET2_50ms() interrupt 5//延时50ms
  85          {
  86   1              TF2=0;
  87   1              timer++;
  88   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    372    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
